!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("mathjs")):"function"==typeof define&&define.amd?define(["mathjs"],e):"object"==typeof exports?exports.npAlgebraic=e(require("mathjs")):t.npAlgebraic=e(t.math)}(window,function(t){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(e,n){e.exports=t},function(t,e){class n{constructor(t,e,n,i){if(this._expStr=t,this.mathInstance=i,this.node=i.parse(t),this.scope=e,this.customFunRepos=n,this.containsCustomFuns=[],!this.node)throw"创建表达式对象失败";this.compile()}calcu(){try{let t=this.code.evaluate(this.scope.getVariableMap());return t instanceof Function?NaN:t}catch(t){return console.error("calcu："+t),NaN}}isPower0(t){if(this._hasFunctionNode())return!1;return!this.getVaris()[t]}isPower1(t){if(this._hasFunctionNode())return!1;return this.derivative(t).isPower0(t)}isPower2(t){if(this._hasFunctionNode())return!1;return this.derivative(t).isPower1(t)}derivative(t){let e=this.mathInstance.derivative(this._expStr,t);return e.isNode&&(e=e.toString()),new n(e,this.scope,this.customFunRepos,this.mathInstance)}getVaris(t={}){let e={};return this.node.filter?(this.node.filter((n,i)=>{if(!n.isFunctionNode||t[n.fn.name])"fn"!==i&&(!n.isSymbolNode||"pi"===n.name&&"PI"===n.name&&"e"===n.name&&"E"===n.name||(e[n.name]=n.name));else{let i=this.customFunRepos.getByFunName(n.fn.name);if(!i)return;t[n.fn.name]=i;let r=i.expression.getVaris(t);for(var s in r)e[s]=r[s]}}),e):e}_hasFunctionNode(){let t=!1;return this.node.traverse((e,n,i)=>{e.isFunctionNode&&(t=!0)}),t}getCustomFuns(){return this.containsCustomFuns.slice(0)}toString(){return this.node.toString()}toTex(){return this.node.toTex()}replaceTexByBl(t){return t=(t||[]).concat(["pi","PI","e","E"]),this.node.toTex({handler:function(e){if(e.isSymbolNode&&-1===t.indexOf(e.name))return"$bl{"+e.name+",2} "}})}compile(){this.code=this.node.compile();let t=this.customFunRepos.getFunNames(),e=[];try{this.node.traverse((n,i,s)=>{n.isFunctionNode&&t.indexOf(n.name)&&e.push(n.name),n.isSymbolNode&&"fn"!==i&&(this.mathInstance[n.name]instanceof Function||this.scope.addVariable(n.name))})}catch(t){throw console.log("创建表达式对象失败："+t),"创建表达式对象失败："+t}this.containsCustomFuns=e}compileByCustomFun(t){-1===this.containsCustomFuns.indexOf(t)||this.compile()}}n.prototype.isExpression=!0,t.exports=n},function(t,e,n){const i=n(1);t.exports=class{constructor(t,e,n,i){this.attributes={funName:t.funName,expStr:t.expStr,inVariables:t.inVariables,note:t.note},this.scope=e,this.repos=n,this.mathInstance=i,this._createExpression(),this._createCustomFunctionFromMath(!0)}update(t,e){return e&&(this.attributes.note=e),!(!t||t===this.attributes.expStr||(this.attributes.expStr=t,this._createExpression(),this._createCustomFunctionFromMath(),0))}_createExpression(){this.expression=new i(this.attributes.expStr,this.scope,this.repos,this.mathInstance)}_createCustomFunctionFromMath(t=!1){let e=this.attributes.funName+"("+this.attributes.inVariables.join(",")+") = "+this.attributes.expStr,n=this.mathInstance.parse(e),i=n.evaluate(this.scope.getVariableMap());if(t){let t={[this.attributes.funName]:i};this.mathInstance.import(t)}this.node=n,this.cosFun=i}}},function(t,e,n){var i=n(0),s=n(4),r=n(1),o=n(5),a=n(2),u=n(6),c=/^[\u00C0-\u02AF\u0370-\u03FF\u2100-\u214F$A-Za-z_][\u00C0-\u02AF\u0370-\u03FF\u2100-\u214F$A-Za-z0-9_]*$/;function h(){this.mathInstance=i.create(),this.mathInstance.config({epsilon:1e-16}),this.scope=new s,this.expressions=[],this.customFunRepos=new u(this.scope,this.mathInstance),this.__configMath__()}h.prototype={__configMath__:function(){this.mathInstance.config({predictable:!0}),this.mathInstance.import(o),this.mathInstance.floor.toTex="\\lfloor ${args[0]}\\rfloor",this.mathInstance.round.toTex="round(${args[0]})",this.mathInstance.xor.toTex="${args[0]} \\oplus ${args[1]}"},createCustomFunction:function(t,e,n,i){if(1===this.testCustomFunName(t)&&this.testSyntax(e)&&n instanceof Array){var s=new a({funName:t,expStr:e,inVariables:n,note:i},this.scope,this.customFunRepos,this.mathInstance);return s?(this.customFunRepos.add(s),s):void 0}},updateCustomFunction:function(t,e,n){let i=this.customFunRepos.getByFunName(t);if(i)return i.update(e,n)&&0!==this.expressions.length?(this.expressions.forEach(function(e){e.compileByCustomFun(t)}),!0):void 0},createAlgeObjByStr:function(t){let e=new r(t,this.scope,this.customFunRepos,this.mathInstance);return this.expressions.push(e),e},testSyntax:function(t){try{if(""===t)return!1;var e=this.createAlgeObjByStr(t);return!!e&&(e.calcu(),!0)}catch(t){return!1}},testCustomFunName:function(t){return c.test(t)&&"thet"!=t&&"x"!=t&&"y"!=t&&"pi"!=t&&"e"!=t?this.scope[t]?-2:this.mathInstance[t]?-2:1:-1},strToLatex:function(t){try{var e=this.createAlgeObjByStr(t);return!!e&&(e.calcu(),e.toTex())}catch(t){return!1}},set:function(t,e){this.scope.setValueByVariable(t,e)},get:function(t){return this.scope.getValueByVariable(t)},addVariable:function(t){this.scope.addVariable(t)},toJSONArrayCustomFun:function(){return this.customFunRepos.toJSONArray()},fromJSONArrayCustomFun:function(t){this.customFunRepos.fromJSONArray(t)},getScope:function(){return this.scope.getVariableMap()},isVari:function(t){return!(!t||""==t||this.mathInstance[t]instanceof Function)&&c.test(t)},reset:function(){this.scope.reset(),this.customFunRepos.reset()}},t.exports=h},function(t,e){var n=function(){this.variableMap={},this.reset()};n.prototype={setValueByVariable:function(t,e){this.variableMap[t]=parseFloat(e)},getValueByVariable:function(t){return this.variableMap[t]},hasVariable:function(t){return void 0!==this.variableMap[t]},addVariable:function(t){this.hasVariable(t)||(this.variableMap[t]=Math.random())},getVariableMap:function(){return this.variableMap},reset:function(){this.variableMap={PI:Math.PI,E:Math.E,pi:Math.PI,e:Math.E}}},t.exports=n},function(t,e,n){var i=n(0);t.exports={less:i.typed("less",{"number, number":function(t,e){return t<e?1:0}}),lesse:i.typed("lesse",{"number,number":function(t,e){return t>e?0:1}}),IF:i.typed("IF",{"number,number,number":function(t,e,n){return i.isZero(t)?n:e}}),if:i.typed("eIF",{"...":function(t){var e=t.length;if(e>=2){var n=NaN;e%2&&(n=t[e-1]);for(var i=0;i<e-1;i+=2)if(t[i])return t[i+1];return n}return NaN}}),prime:i.typed("prime",{number:function(t){return i.isInteger(t)&&i.isPositive(t)&&i.isPrime(t)?1:0}}),parity:i.typed("parity",{number:function(t){return i.isInteger(t)&&t%2!=0?1:0}}),vpa:i.typed("vpa",{"...":function(t){var e=t[0],n=t[1],s=t[2];(void 0===n||n<0)&&(n=0),n=parseInt(n),void 0===s&&(s=0);var r=Math.pow(10,n),o=e*r;return i.isZero(s)?Math.round(o)/r:s>0?Math.ceil(o)/r:Math.floor(o)/r}})}},function(t,e,n){var i=n(2),s=function(t,e){this.collection=[],this.mathInstance=e,this.map={},this.scope=t};s.prototype={add:function(t){this.collection.indexOf(t)>-1||(this.collection.push(t),this.map[t.attributes.funName]=t)},getByFunName:function(t){return this.map[t]},getFunNames:function(){return this.collection.map(function(t){return t.attributes.funName})},reset:function(){for(var t in this.map)this.map.hasOwnProperty(t)&&delete this.mathInstance[t];this.map={},this.collection=[]},toJSONArray:function(){for(var t,e=[],n=0;t=this.collection[n];n++)e.push(t.attributes);return e},fromJSONArray:function(t){for(var e,n=0;e=t[n];n++)this.add(new i(e,this.scope,this,this.mathInstance))}},t.exports=s}])});